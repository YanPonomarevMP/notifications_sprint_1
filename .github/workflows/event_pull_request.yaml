# –ú–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è —Å–æ–±—ã—Ç–∏—è pull request –≤ –≥–ª–∞–≤–Ω—É—é –≤–µ—Ç–∫—É.
name: pull request event

on:
    pull_request:
        branches: [ main ]

jobs:
    linter:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: [ '3.8', '3.9' ]
        name: linters with python ${{ matrix.python-version }}  # –£–¥–æ–±–Ω–æ –∂–µ –≤–∏–¥–µ—Ç—å –∫–∞–∫–∞—è —Å–µ–π—á–∞—Å –≤–µ—Ä—Å–∏—è.
        steps:
            -   uses: actions/checkout@v2
            -   name: Install Python
                uses: actions/setup-python@v2
                with:
                    python-version: ${{ matrix.python-version }}
            -   name: Install dependencies
                run: |
                    python -m pip install --upgrade pip
                    pip install flake8==4.0.1 wemake-python-styleguide==0.16.1 \
                    mypy==0.950 flake8-bandit==2.1.2 bandit==1.7.2 types-redis==4.1.19 \
                    types-requests==2.27.29 lxml==4.9.1

            -   name: Flake8
                run: flake8 .

            -   name: Mypy
                run: mypy .
    Telegram:
        name: Telegram message
        runs-on: ubuntu-latest
        needs: linter
        steps:
            -   name: send telegram message
                uses: appleboy/telegram-action@master
                with:
                    # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ github (Settings.Secrets.Actions)
                    # secrets.TELEGRAM_TO ‚Äî id —á–∞—Ç–∞, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–∞–∫:
                    # curl https://api.telegram.org/bot<token>/getUpdates (["result"]["chat"]["id"])
                    # secrets.TELEGRAM_TOKEN ‚Äî —Ç–æ–∫–µ–Ω, –≤—ã–¥–∞–≤–∞–µ–º—ã–π BotFather-–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞
                    to: ${{ secrets.TELEGRAM_TO }}
                    token: ${{ secrets.TELEGRAM_TOKEN }}
                    message: |
                        ${{ github.actor }} created pull request (linters passed, keep calm üôÇ):
                        Pull request message: ${{ github.event.pull_request[0].message }}
                        
                        Repository: ${{ github.repository }}
                        
                        See changes: https://github.com/${{ github.repository }}/pull/${{github.event.pull_request.head.sha}}
